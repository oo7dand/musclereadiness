
<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Muscle Ready</title><link rel="manifest" href="manifest.webmanifest"><meta name="theme-color" content="#0b1120">
<style>
:root{--bg:#0b1120;--card:#0e1628;--text:#e8ecf3;--muted:#9aa6b2;--border:#1c2740;--red:#ef4444;--yellow:#f59e0b;--green:#10b981;--stale:#064e3b}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
header{display:flex;gap:10px;align-items:center;padding:12px 16px;background:#0a1020;border-bottom:1px solid var(--border)}
header img{width:28px;height:28px;border-radius:6px} header h1{margin:0;font-size:18px}
nav{display:flex;gap:8px;padding:8px 16px;background:#0a1020;position:sticky;top:56px;z-index:9}
.tab{background:#0f182e;color:var(--muted);border:1px solid var(--border);padding:8px 12px;border-radius:10px}
.tab.active{color:#fff;background:#111c32;border-color:#334155} main{max-width:1000px;margin:0 auto;padding:14px}
.panel{display:none}.panel.active{display:block}.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px}
.slim{display:flex;justify-content:space-between;align-items:center;gap:8px}
.row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center;margin-bottom:10px}
input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b1426;color:#e5e7eb}
.btn{border:1px solid #2a3a55;background:#182840;color:#e5e7eb;padding:10px 12px;border-radius:10px;cursor:pointer}
.btn.ghost{background:transparent;border-color:var(--border)} .btn.small{padding:6px 10px;font-size:13px}
.badge{padding:4px 10px;border-radius:999px;font-size:12px} .red{background:#ef4444;color:#fff} .yellow{background:#f2c14e;color:#111} .green{background:#10b981;color:#073b2b}
.mrow{display:flex;gap:10px;align-items:center} .micon{width:26px;height:26px;object-fit:contain}
#openData{display:block;width:100%;margin-top:14px;background:transparent;border:1px dashed var(--border);color:var(--muted)}
</style></head><body>
<header><img src="icon-192.png"><h1>Muscle Ready</h1></header>
<nav>
  <button class="tab active" data-tab="train">Train</button>
  <button class="tab" data-tab="muscles">Muscles</button>
  <button class="tab" data-tab="exercises">Exercises</button>
  <button class="tab" data-tab="data">Data</button>
</nav>
<main>
<section id="train" class="panel active">
  <div class="card"><div class="slim">
    <div><strong>Log workout</strong><div id="dropdownHint" style="opacity:.7;font-size:12px">Exercises sorted by what’s most ready</div></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap"><input id="exerciseFilter" placeholder="Filter…"><select id="logExerciseNow"></select><button class="btn" id="logNowBtn">Mark Done</button></div>
  </div></div>
  <div class="slim"><h3 style="margin:6px 0">Readiness</h3><div style="font-size:12px;opacity:.7">Tap Clear to force ready</div></div>
  <div id="cards" class="grid"></div>
  <button id="openData" class="btn ghost">Advanced settings</button>
  <hr style="border:0;border-top:1px solid var(--border);margin:12px 0"><h3>History</h3><div id="history"></div>
</section>
<section id="muscles" class="panel"><h3>Muscles</h3><div id="mList"></div></section>
<section id="exercises" class="panel"><h3>Exercises</h3><div id="eList"></div></section>
<section id="data" class="panel">
  <div class="slim"><h3>Advanced settings</h3><button class="btn ghost" id="backToTrain">Back to Train</button></div>
  <div class="card">
    <div class="row"><label>Default yellow window (hrs)</label><input id="setYellowDefault" type="number" min="0" value="20"></div>
    <div class="row"><label>Stale threshold (days)</label><input id="setStaleDays" type="number" min="1" value="10"></div>
    <div class="row"><label>Global exercise logging</label>
      <select id="globalExerciseMode"><option value="adjust">Adjust (add hours, capped)</option><option value="reset">Reset to full cooldown</option></select>
    </div>
    <button class="btn" id="saveQuick">Save Settings</button>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn" id="exportBtn">Export JSON</button>
      <label class="btn ghost">Import JSON <input id="importFile" type="file" accept="application/json" hidden></label>
      <button class="btn" id="wipeBtn">Wipe</button>
    </div>
  </div>
</section>
</main>
<script>
if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
const ICONS = {
  "Abs": "assets/muscles/abs.png",
  "Obliques": "assets/muscles/obliques.png",
  "Biceps": "assets/muscles/biceps.png",
  "Triceps": "assets/muscles/triceps.png",
  "Chest / Pecs": "assets/muscles/chest_pecs.png",
  "Glutes": "assets/muscles/glutes.png",
  "Calves": "assets/muscles/calves.png",
  "Hamstrings": "assets/muscles/hamstrings.png",
  "Quads": "assets/muscles/quads.png",
  "Lats": "assets/muscles/lats.png",
  "Shoulders / Delts": "assets/muscles/shoulders_delts.png",
  "Lower back": "assets/muscles/lower_back.png",
  "Traps": "assets/muscles/traps.png",
  "Upper back": "assets/muscles/upper_back.png"
};
const KEY="mr:hosted";
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s)), uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);
const h2ms=h=>Number(h||0)*3600000;
function remMs(m){ if(!m.lastAt) return 0; return (new Date(m.lastAt).getTime()+h2ms(m.cooldown||0))-Date.now(); }
function msToDh(ms){ if(ms<=0) return "0h"; const d=Math.floor(ms/86400000); const h=Math.ceil((ms%86400000)/3600000); return (d?d+'d ':'')+h+'h'; }
function ago(iso){ if(!iso) return 'never'; const diff=Date.now()-new Date(iso).getTime(); const d=Math.floor(diff/86400000); const h=Math.ceil((diff%86400000)/3600000); return (d?d+'d ':'')+h+'h ago'; }
function setRemainingMsCapped(m,ms){ const cap=h2ms(m.cooldown||0); const clamped=Math.min(Math.max(0,ms),cap); const lastPrime=Date.now()+clamped-cap; m.lastAt=new Date(lastPrime).toISOString(); }

function spec(){ const N=(n,cd)=>({id:uid(),name:n,cooldown:cd,yellow:null,lastAt:null,lastWorkedAt:null});
  const muscles=[N('Quads',48),N('Hamstrings',48),N('Glutes',48),N('Lats',36),N('Chest / Pecs',36),N('Shoulders / Delts',36),N('Traps',36),N('Lower back',36),N('Upper back',24),N('Biceps',24),N('Triceps',24),N('Abs',24),N('Obliques',24),N('Calves',24)];
  const idBy=Object.fromEntries(muscles.map(m=>[m.name,m.id]));
  const ex=[
    {id:uid(),name:'Barbell back squat',override:'adjust',impacts:[['Quads',48],['Glutes',24],['Hamstrings',24],['Lower back',36],['Abs',12]].map(([n,h])=>({mid:idBy[n],hours:h}))},
    {id:uid(),name:'Bench press',override:'adjust',impacts:[['Chest / Pecs',36],['Shoulders / Delts',24],['Triceps',12]].map(([n,h])=>({mid:idBy[n],hours:h}))},
    {id:uid(),name:'Pull-up',override:'adjust',impacts:[['Lats',36],['Biceps',12],['Upper back',24],['Abs',12]].map(([n,h])=>({mid:idBy[n],hours:h}))}
  ];
  return {settings:{yellowDefault:20,staleDays:10,globalExerciseMode:'adjust'},muscles,exercises:ex,logs:[]};
}
function load(){ try{ const raw=localStorage.getItem(KEY); if(!raw) return spec(); const o=JSON.parse(raw); if(!o.muscles) return spec(); return o; }catch(e){ return spec(); } }
function save(){ try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){} }
let state=load();

const importance=['Quads','Hamstrings','Glutes','Lats','Chest / Pecs','Shoulders / Delts','Traps','Lower back','Upper back','Biceps','Triceps','Abs','Obliques','Calves'];
const rankImp=new Map(importance.map((n,i)=>[n,i]));
const sortKey=m=>{const r=remMs(m);return [r>0?0:1,r,rankImp.get(m.name)??999];};

function icon(name){ const src=ICONS[name]||''; return src?`<img class="micon" src="${src}" alt="${name}">`:''; }
function color(m){ const r=remMs(m); if(r>0){const y=m.yellow??state.settings.yellowDefault; return r<=h2ms(y)?'yellow':'red';} return 'green'; }

function renderTrain(){
  const grid=document.getElementById('cards'); grid.innerHTML='';
  state.muscles.slice().sort((a,b)=>{const A=sortKey(a),B=sortKey(b);return A[0]-B[0]||A[1]-B[1]||A[2]-B[2];}).forEach(m=>{
    const r=remMs(m); const card=document.createElement('div'); card.className='card';
    card.innerHTML=`<div class="slim"><div class="mrow">${icon(m.name)}<div><div style="font-weight:600">${m.name}</div><div style="opacity:.7;font-size:12px">last: ${ago(m.lastWorkedAt??m.lastAt)}</div></div></div><div><span class="badge ${color(m)}">${r>0?msToDh(r):'Ready'}</span></div></div>
    <div style="margin-top:8px"><button class="btn small ghost" data-act="clear" data-id="${m.id}" ${r<=0?'disabled':''}>Clear</button></div>`;
    grid.appendChild(card);
  });
}
document.addEventListener('click',e=>{const b=e.target.closest('button'); if(!b) return; if(b.dataset.act==='clear'){const m=state.muscles.find(x=>x.id===b.dataset.id); if(!m) return; setRemainingMsCapped(m,0); m.lastWorkedAt=new Date().toISOString(); state.logs.unshift({id:uid(),txt:`Cleared ${m.name} to ready`}); state.logs=state.logs.slice(0,100); save(); renderAll();}});

function renderLists(){
  const m=document.getElementById('mList'); m.innerHTML=state.muscles.map(mm=>`<div class="card"><div class="slim"><div class="mrow">${icon(mm.name)}<div>${mm.name}<div style="opacity:.7;font-size:12px">Cooldown ${mm.cooldown}h</div></div></div></div></div>`).join('');
  const e=document.getElementById('eList'); e.innerHTML=state.exercises.map(ex=>`<div class="card"><div class="slim"><div><div>${ex.name}</div><div style="opacity:.7;font-size:12px">${ex.impacts.map(i=>{const nm=state.muscles.find(m=>m.id===i.mid)?.name||'?'; return nm+': +'+i.hours+'h';}).join(', ')}</div></div></div></div>`).join('');
}
function renderHistory(){ const h=document.getElementById('history'); h.innerHTML = state.logs.length? state.logs.slice(0,30).map(l=>`<div class="card">${l.txt}</div>`).join('') : '<div class="card">No history yet.</div>'; }

function makeExerciseOptions(filter=''){ const sel=document.getElementById('logExerciseNow'); const q=(filter||'').toLowerCase().trim();
  const ms=state.muscles.slice().sort((a,b)=>{const A=sortKey(a),B=sortKey(b);return A[0]-B[0]||A[1]-B[1]||A[2]-B[2];});
  const mr=new Map(ms.map((m,i)=>[m.id,i])); const score=ex=>ex.impacts.reduce((s,i)=>Math.min(s, mr.get(i.mid)??9999), 9999);
  const all=state.exercises.slice().sort((a,b)=>score(a)-score(b)||a.name.localeCompare(b.name));
  sel.innerHTML=''; (q?all.filter(x=>x.name.toLowerCase().includes(q)):all).forEach(ex=> sel.insertAdjacentHTML('beforeend', `<option value="${ex.id}">${ex.name}</option>`));
  document.getElementById('dropdownHint').textContent='Exercises sorted for: '+ms.slice(0,3).map(m=>m.name).join(' · ');
}
function attachFilter(){ const inp=document.getElementById('exerciseFilter'); if(inp) inp.addEventListener('input',()=>makeExerciseOptions(inp.value||'')); }
function openYT(q){ const s=encodeURIComponent(q+' proper form'); const apps=[`youtube://www.youtube.com/results?search_query=${s}`,`vnd.youtube://results?search_query=${s}`]; let ok=false; try{const w=window.open(apps[0],'_blank'); ok=!!w;}catch(_){ } if(!ok) window.open(`https://www.youtube.com/results?search_query=${s}`,'_blank'); }
(function longPress(){ const sel=document.getElementById('logExerciseNow'); let t=null; const go=()=>{const ex=state.exercises.find(e=>e.id===sel.value); if(ex) openYT(ex.name);}; const start=()=>t=setTimeout(go,650); const end=()=>{if(t){clearTimeout(t); t=null;}};
  sel.addEventListener('mousedown',start); sel.addEventListener('mouseup',end); sel.addEventListener('mouseleave',end);
  sel.addEventListener('touchstart',start,{passive:true}); sel.addEventListener('touchend',end); sel.addEventListener('touchcancel',end);
})();

function behavior(ex){ const g=state.settings.globalExerciseMode||'adjust'; return ex.override==='reset'?'reset':(ex.override==='adjust'?'adjust':g); }
document.getElementById('logNowBtn').addEventListener('click',()=>{
  const id=document.getElementById('logExerciseNow').value; const ex=state.exercises.find(e=>e.id===id); if(!ex) return alert('Pick an exercise');
  const now=new Date().toISOString(); const mode=behavior(ex);
  if(mode==='reset'){ ex.impacts.forEach(i=>{ const m=state.muscles.find(mm=>mm.id===i.mid); if(!m) return; setRemainingMsCapped(m, h2ms(m.cooldown||0)); m.lastWorkedAt=now; }); }
  else { ex.impacts.forEach(i=>{ const m=state.muscles.find(mm=>mm.id===i.mid); if(!m) return; const cap=h2ms(m.cooldown||0); const cur=Math.min(cap, Math.max(0, remMs(m))); const add=Math.min(cap, h2ms(i.hours||0)); const targ=Math.min(cap, Math.max(cur, cur+add)); setRemainingMsCapped(m, targ); m.lastWorkedAt=now; }); }
  state.logs.unshift({id:uid(),txt:`Done: ${ex.name}`}); state.logs=state.logs.slice(0,100); save(); renderAll();
});

document.querySelectorAll('button.tab').forEach(b=> b.addEventListener('click',()=>{ document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active')); b.classList.add('active'); document.getElementById(b.dataset.tab).classList.add('active'); if(b.dataset.tab==='train') makeExerciseOptions(document.getElementById('exerciseFilter').value||''); }));
document.getElementById('openData').addEventListener('click',()=>{ document.querySelector('button.tab[data-tab="data"]').click(); });
document.getElementById('backToTrain').addEventListener('click',()=>{ document.querySelector('button.tab[data-tab="train"]').click(); });

function renderAll(){ renderTrain(); renderLists(); renderHistory(); makeExerciseOptions(document.getElementById('exerciseFilter')?.value||''); document.getElementById('setYellowDefault').value=state.settings.yellowDefault; document.getElementById('setStaleDays').value=state.settings.staleDays; document.getElementById('globalExerciseMode').value=state.settings.globalExerciseMode; }
attachFilter(); let state = load(); renderAll();
</script></body></html>
